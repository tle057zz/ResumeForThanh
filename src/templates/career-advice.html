<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Career Advice - TLe Portfolio</title>
  <link rel="preload" href="vendor/bootstrap/css/bootstrap.min.css" as="style">
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link rel="preload" href="css/main.css" as="style">
  <link href="css/main.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <!-- Enhanced animations and styling -->
  <script defer src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>
  <script defer src="https://unpkg.com/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
  
  <style>
    /* Enhanced career advice styling */
    :root {
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-info: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.04)"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grain)"/></svg>');
      pointer-events: none;
      z-index: -1;
    }

    .main {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
      max-width: 1200px;
      position: relative;
      overflow: hidden;
      display: block;
    }

    .main::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
      z-index: -1;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    h1 {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
      font-size: 3rem;
      margin-bottom: 2rem;
      position: relative;
      text-align: center;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }

    /* Enhanced cards */
    .card {
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.4s ease;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 50px rgba(102, 126, 234, 0.2);
    }

    .card:hover::before {
      transform: scaleX(1);
    }

    /* Enhanced buttons */
    .btn {
      border-radius: 12px;
      font-weight: 600;
      padding: 12px 24px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: none;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .btn-success {
      background: var(--gradient-success);
      color: white;
    }

    .btn-warning {
      background: var(--gradient-warning);
      color: white;
    }

    .btn-danger {
      background: var(--gradient-danger);
      color: white;
    }

    .btn-outline-primary {
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid #667eea;
      color: #667eea;
    }

    .btn-outline-primary:hover {
      background: var(--gradient-primary);
      color: white;
      transform: translateY(-2px);
    }

    /* Enhanced form elements */
    .form-control {
      border-radius: 12px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      padding: 14px 18px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
    }

    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      background: rgba(255, 255, 255, 0.95);
      transform: translateY(-1px);
    }

    /* Enhanced alerts */
    .alert {
      border-radius: 16px;
      border: none;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .alert-info {
      background: linear-gradient(135deg, rgba(67, 233, 123, 0.1), rgba(56, 249, 215, 0.1));
      border-left: 4px solid #43e97b;
      color: #1a5d3a;
    }

    .alert-success {
      background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
      border-left: 4px solid #4facfe;
      color: #1a365d;
    }

    /* Animated post cards */
    .post-card {
      margin-bottom: 2rem;
      position: relative;
    }

    .post-card .card-body {
      padding: 2rem;
    }

    .card-title {
      background: var(--gradient-secondary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 700;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    /* Floating action elements */
    .floating-element {
      position: fixed;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .floating-element:hover {
      transform: scale(1.1);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }

    .scroll-to-top {
      bottom: 30px;
      right: 30px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .scroll-to-top.show {
      opacity: 1;
      visibility: visible;
    }

    /* Enhanced form sections */
    .form-section {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Image preview enhancements */
    .img-thumbnail {
      border-radius: 12px;
      transition: all 0.3s ease;
      border: 3px solid rgba(102, 126, 234, 0.2);
    }

    .img-thumbnail:hover {
      transform: scale(1.05);
      border-color: #667eea;
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    /* Radio button enhancements */
    .form-check-input:checked {
      background: var(--gradient-primary);
      border-color: #667eea;
    }

    .form-check-label {
      font-weight: 500;
      color: #4a5568;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .form-check-label:hover {
      color: #667eea;
    }

    /* Loading animation */
    .loading {
      position: relative;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid transparent;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Pulse animation for new posts */
    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
      100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
    }
  </style>
</head>
<body>
  <header id="header" class="header d-flex flex-column justify-content-center">
    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="index.html#basic-intro"><i class="bi bi-info-circle navicon"></i><span>Basic Introductions</span></a></li>
        <li><a href="index.html"><i class="bi bi-house navicon"></i><span>Home</span></a></li>
        <li><a href="career-advice.html" class="active"><i class="bi bi-lightbulb navicon"></i><span>Career Advice</span></a></li>
        <li><a href="traffic.html"><i class="bi bi-graph-up navicon"></i><span>Traffic</span></a></li>
      </ul>
    </nav>
  </header>

  <i class="header-toggle d-xl-none bi bi-list"></i>

  <main class="main container py-5">
    <div class="mb-3">
      <a href="index.html" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left me-1"></i>Back to Homepage
      </a>
    </div>
    <h1 class="mb-4">Career Advice</h1>
    <div class="alert alert-info mb-4">
      <strong>Content Formatting Options:</strong><br>
      <ul class="mb-1">
        <li><strong>Plain Text:</strong> No formatting, displays as-is</li>
        <li><strong>LaTeX:</strong> Use <code>\textbf{bold}</code>, <code>\textit{italic}</code>, <code>\begin{itemize}\item text\end{itemize}</code>, math <code>\( x^2 \)</code></li>
        <li><strong>Markdown:</strong> Use <code>**bold**</code>, <code>*italic*</code>, <code>- list item</code>, math <code>\( x^2 \)</code></li>
      </ul>
    </div>
    <div id="posts-list" class="mb-4">
      <!-- Posts will be listed here -->
    </div>
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Add New Post</h5>
        <form id="add-post-form">
          <div class="mb-3">
            <input type="text" class="form-control" id="post-title" placeholder="Title" required>
          </div>
          <div class="mb-3">
            <textarea class="form-control" id="post-content" rows="8" placeholder="Content" required></textarea>
          </div>
          <div class="mb-3">
            <label for="post-images" class="form-label">Images (optional)</label>
            <input type="file" class="form-control" id="post-images" multiple accept=".jpg,.jpeg,.gif" onchange="previewImages('post-images', 'post-preview')">
            <small class="form-text text-muted">Supported formats: JPG, JPEG, GIF</small>
            <div id="post-preview" class="mt-2"></div>
          </div>
          <div class="mb-3">
            <label class="form-label">Content Format:</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="post-format" id="post-plain" value="plain">
              <label class="form-check-label" for="post-plain">Plain Text</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="post-format" id="post-latex" value="latex" checked>
              <label class="form-check-label" for="post-latex">LaTeX</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="post-format" id="post-markdown" value="markdown">
              <label class="form-check-label" for="post-markdown">Markdown</label>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Add Post</button>
        </form>
      </div>
    </div>
    <div id="edit-post-section" style="display:none;" class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Edit Post</h5>
        <form id="edit-post-form">
          <div class="mb-3">
            <input type="text" class="form-control" id="edit-post-title" required>
          </div>
          <div class="mb-3">
            <textarea class="form-control" id="edit-post-content" rows="8" required></textarea>
          </div>
          <div class="mb-3">
            <label for="edit-post-images" class="form-label">Images (optional)</label>
            <input type="file" class="form-control" id="edit-post-images" multiple accept=".jpg,.jpeg,.gif" onchange="previewImages('edit-post-images', 'edit-post-preview')">
            <small class="form-text text-muted">Supported formats: JPG, JPEG, GIF</small>
            <div id="edit-post-preview" class="mt-2"></div>
            <div id="edit-existing-images" class="mt-2"></div>
          </div>
          <div class="mb-3">
            <label class="form-label">Content Format:</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="edit-post-format" id="edit-post-plain" value="plain">
              <label class="form-check-label" for="edit-post-plain">Plain Text</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="edit-post-format" id="edit-post-latex" value="latex">
              <label class="form-check-label" for="edit-post-latex">LaTeX</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="edit-post-format" id="edit-post-markdown" value="markdown">
              <label class="form-check-label" for="edit-post-markdown">Markdown</label>
            </div>
          </div>
          <input type="hidden" id="edit-post-id">
          <button type="submit" class="btn btn-success">Save Changes</button>
          <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
        </form>
      </div>
    </div>
  </main>
  
  <!-- Floating scroll to top button -->
  <div class="floating-element scroll-to-top" onclick="scrollToTop()">
    <i class="bi bi-arrow-up"></i>
  </div>

  <script>
    // Initialize GSAP ScrollTrigger
    gsap.registerPlugin(ScrollTrigger);

    // Animate elements on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Animate main title
      gsap.fromTo('h1', 
        { opacity: 0, y: -50 }, 
        { opacity: 1, y: 0, duration: 1, ease: 'power3.out' }
      );

      // Animate back button
      gsap.fromTo('.btn-outline-primary', 
        { opacity: 0, x: -30 }, 
        { opacity: 1, x: 0, duration: 0.8, delay: 0.2, ease: 'power3.out' }
      );

      // Animate info alert
      gsap.fromTo('.alert-info', 
        { opacity: 0, y: 30 }, 
        { opacity: 1, y: 0, duration: 0.8, delay: 0.4, ease: 'power3.out' }
      );

      // Animate form cards
      gsap.fromTo('.card', 
        { opacity: 0, y: 50, scale: 0.9 }, 
        { 
          opacity: 1, y: 0, scale: 1, 
          duration: 0.8, 
          delay: 0.6, 
          stagger: 0.2, 
          ease: 'power3.out' 
        }
      );

      // Setup scroll-triggered animations for post cards
      setupScrollAnimations();
      
      // Setup scroll to top functionality
      setupScrollToTop();
    });

    function setupScrollAnimations() {
      // Animate post cards as they enter viewport
      gsap.utils.toArray('.post-card').forEach((card, index) => {
        gsap.fromTo(card, 
          { 
            opacity: 0, 
            y: 60, 
            rotateX: 15,
            scale: 0.95 
          }, 
          {
            opacity: 1,
            y: 0,
            rotateX: 0,
            scale: 1,
            duration: 0.8,
            ease: 'power3.out',
            scrollTrigger: {
              trigger: card,
              start: 'top 85%',
              end: 'bottom 20%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });
    }

    function setupScrollToTop() {
      const scrollButton = document.querySelector('.scroll-to-top');
      
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          scrollButton.classList.add('show');
        } else {
          scrollButton.classList.remove('show');
        }
      });
    }

    function scrollToTop() {
      gsap.to(window, { duration: 1, scrollTo: 0, ease: 'power2.out' });
    }

    // Enhanced form submissions with loading states
    function showLoading(button) {
      button.classList.add('loading');
      button.disabled = true;
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Processing...';
      
      setTimeout(() => {
        button.classList.remove('loading');
        button.disabled = false;
        button.innerHTML = originalText;
      }, 1000);
    }

    // Add pulse animation to new posts
    function addPulseToNewPost() {
      const firstCard = document.querySelector('.post-card');
      if (firstCard) {
        firstCard.classList.add('pulse');
        setTimeout(() => {
          firstCard.classList.remove('pulse');
        }, 4000);
      }
    }

    // Enhanced hover effects for cards
    function setupCardHoverEffects() {
      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('mouseenter', function() {
          gsap.to(this, { 
            scale: 1.02, 
            duration: 0.3, 
            ease: 'power2.out' 
          });
        });
        
        card.addEventListener('mouseleave', function() {
          gsap.to(this, { 
            scale: 1, 
            duration: 0.3, 
            ease: 'power2.out' 
          });
        });
      });
    }

    // Initialize hover effects after cards are rendered
    function initializeEnhancements() {
      setupCardHoverEffects();
      setupScrollAnimations();
    }
  </script>

  <script>
    function processLatexText(content) {
      if (!content) return content;
      
      // Process LaTeX text commands
      content = content
        // Bold text
        .replace(/\\textbf\{([^}]*)\}/g, '<strong>$1</strong>')
        // Italic text
        .replace(/\\textit\{([^}]*)\}/g, '<em>$1</em>')
        // Monospace text
        .replace(/\\texttt\{([^}]*)\}/g, '<code>$1</code>')
        .replace(/\\verb\|([^|]*)\|/g, '<code>$1</code>')
        // Line breaks
        .replace(/\\\\/g, '<br>')
        // Paragraph breaks
        .replace(/\n\s*\n/g, '</p><p>')
        // Process itemize environments
        .replace(/\\begin\{itemize\}([\s\S]*?)\\end\{itemize\}/g, function(match, items) {
          const processedItems = items
            .split(/\\item\s+/)
            .filter(item => item.trim())
            .map(item => `<li>${item.trim()}</li>`)
            .join('');
          return `<ul>${processedItems}</ul>`;
        })
        // Process enumerate environments
        .replace(/\\begin\{enumerate\}([\s\S]*?)\\end\{enumerate\}/g, function(match, items) {
          const processedItems = items
            .split(/\\item\s+/)
            .filter(item => item.trim())
            .map(item => `<li>${item.trim()}</li>`)
            .join('');
          return `<ol>${processedItems}</ol>`;
        });
      
      // Wrap in paragraph tags if not already wrapped
      if (!content.includes('<p>') && !content.includes('<ul>') && !content.includes('<ol>')) {
        content = `<p>${content}</p>`;
      }
      
      return content;
    }

    function renderMath(element) {
      renderMathInElement(element, {
        delimiters: [
          {left: '\\[', right: '\\]', display: true},
          {left: '\\(', right: '\\)', display: false},
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false}
        ]
      });
    }

    // ---------------- Server-backed storage helpers ----------------
    async function fetchPosts() {
      try {
        const res = await fetch('/api/career-posts', { cache: 'no-store' });
        const data = await res.json();
        if (Array.isArray(data)) return data;
        return [];
      } catch (_) {
        return [];
      }
    }

    async function createPostOnServer(post) {
      await fetch('/api/career-posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(post)
      });
    }

    async function updatePostOnServer(id, payload) {
      await fetch(`/api/career-posts/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
    }

    async function deletePostOnServer(id) {
      await fetch(`/api/career-posts/${id}`, { method: 'DELETE' });
    }

    // In-memory cache of posts for the current page session
    let postsCache = [];
    
    function previewImages(inputId, previewId) {
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);
      preview.innerHTML = '';
      
      if (input.files) {
        Array.from(input.files).forEach((file, index) => {
          if (file.type.match(/image\/(jpeg|jpg|gif)/)) {
            const reader = new FileReader();
            reader.onload = function(e) {
              const imgDiv = document.createElement('div');
              imgDiv.className = 'd-inline-block me-2 mb-2 position-relative';
              imgDiv.innerHTML = `
                <img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover;" class="rounded">
                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0" onclick="removePreviewImage(this, '${inputId}', ${index})" style="transform: translate(50%, -50%);">&times;</button>
              `;
              preview.appendChild(imgDiv);
            };
            reader.readAsDataURL(file);
          }
        });
      }
    }

    function removePreviewImage(button, inputId, index) {
      const input = document.getElementById(inputId);
      const dt = new DataTransfer();
      
      Array.from(input.files).forEach((file, i) => {
        if (i !== index) {
          dt.items.add(file);
        }
      });
      
      input.files = dt.files;
      previewImages(inputId, inputId.replace('-images', '-preview'));
    }

    function displayExistingImages(images, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      if (images && images.length > 0) {
        const label = document.createElement('div');
        label.innerHTML = '<strong>Current Images:</strong>';
        label.className = 'mb-2';
        container.appendChild(label);
        
        images.forEach((image, index) => {
          const imgDiv = document.createElement('div');
          imgDiv.className = 'd-inline-block me-2 mb-2 position-relative';
          imgDiv.innerHTML = `
            <img src="${image}" style="width: 100px; height: 100px; object-fit: cover;" class="rounded">
            <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0" onclick="removeExistingImage(${index})" style="transform: translate(50%, -50%);">&times;</button>
          `;
          container.appendChild(imgDiv);
        });
      }
    }

    let currentEditIndex = null;
    function removeExistingImage(imageIndex) {
      if (currentEditIndex !== null) {
        const posts = getPosts();
        if (posts[currentEditIndex].images) {
          posts[currentEditIndex].images.splice(imageIndex, 1);
          savePosts(posts);
          displayExistingImages(posts[currentEditIndex].images, 'edit-existing-images');
        }
      }
    }

    async function processImages(fileInput) {
      const files = fileInput.files;
      const images = [];
      
      for (let file of files) {
        if (file.type.match(/image\/(jpeg|jpg|gif)/)) {
          const base64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsDataURL(file);
          });
          images.push(base64);
        }
      }
      
      return images;
    }

    function renderPosts() {
      const posts = postsCache;
      const list = document.getElementById('posts-list');
      if (posts.length === 0) {
        list.innerHTML = '<p class="text-muted">No posts yet. Add your first career advice post!</p>';
        return;
      }
      
      list.innerHTML = posts.map((post, idx) => {
        let content = post.content;
        const format = post.format || 'plain';
        
        if (format === 'latex') {
          content = processLatexText(content);
        } else if (format === 'markdown') {
          content = marked.parse(content);
        } else {
          // Plain text - escape HTML and preserve line breaks
          content = content.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');
        }
        
        // Format timestamp
        const createdAt = post.createdAt ? new Date(post.createdAt).toLocaleString() : 'Unknown';
        const updatedAt = post.updatedAt ? new Date(post.updatedAt).toLocaleString() : null;
        const timestampText = updatedAt && updatedAt !== createdAt ? 
          `Updated: ${updatedAt}` : `Created: ${createdAt}`;
        
        // Display images
        let imagesHtml = '';
        if (post.images && post.images.length > 0) {
          imagesHtml = `
            <div class="mb-3">
              ${post.images.map(image => `
                <img src="${image}" class="img-thumbnail me-2 mb-2" style="max-width: 200px; max-height: 200px; cursor: pointer;" onclick="openImageModal('${image}')">
              `).join('')}
            </div>
          `;
        }
        
        return `
          <div class="card mb-3 post-card" data-post-index="${idx}" data-post-id="${post.id}">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">${post.title} <small class="text-muted">(${format})</small></h5>
                <small class="text-muted">${timestampText}</small>
              </div>
              <div class="card-text">${content}</div>
              ${imagesHtml}
              <div class="mt-3">
                <button class="btn btn-sm btn-warning me-2" onclick="editPost(${idx})">
                  <i class="bi bi-pencil me-1"></i>Edit
                </button>
                <button class="btn btn-sm btn-danger" onclick="deletePost(${idx})">
                  <i class="bi bi-trash me-1"></i>Delete
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // Render math in LaTeX and Markdown posts
      const mathElements = list.querySelectorAll('.card-text');
      mathElements.forEach((element, idx) => {
        const post = posts[idx];
        if (post && (post.format === 'latex' || post.format === 'markdown')) {
          if (element.textContent.includes('\\(') || element.textContent.includes('\\[')) {
            renderMath(element);
          }
        }
      });
    }

    function openImageModal(imageSrc) {
      const modal = document.createElement('div');
      modal.className = 'modal fade';
      modal.innerHTML = `
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Image Preview</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
              <img src="${imageSrc}" class="img-fluid">
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      const bsModal = new bootstrap.Modal(modal);
      bsModal.show();
      
      modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
      });
    }
    
    document.getElementById('add-post-form').onsubmit = async function(e) {
      e.preventDefault();
      const title = document.getElementById('post-title').value;
      const content = document.getElementById('post-content').value;
      const format = document.querySelector('input[name="post-format"]:checked').value;
      
      // Process images
      const imageInput = document.getElementById('post-images');
      const images = await processImages(imageInput);
      
      await createPostOnServer({ title, content, format, images });
      postsCache = await fetchPosts();
      renderPosts();
      this.reset();
      document.getElementById('post-preview').innerHTML = '';
      document.getElementById('post-latex').checked = true; // Default to LaTeX
      
      // Add enhancements after rendering
      setTimeout(() => {
        initializeEnhancements();
        addPulseToNewPost();
      }, 100);
    };
    
    function editPost(idx) {
      const post = postsCache[idx];
      currentEditIndex = idx;
      
      document.getElementById('edit-post-title').value = post.title;
      document.getElementById('edit-post-content').value = post.content;
      
      // Set the correct radio button
      const format = post.format || 'plain';
      document.querySelector(`input[name="edit-post-format"][value="${format}"]`).checked = true;
      
      // Display existing images
      displayExistingImages(post.images, 'edit-existing-images');
      
      // Clear file input and preview
      document.getElementById('edit-post-images').value = '';
      document.getElementById('edit-post-preview').innerHTML = '';
      
      document.getElementById('edit-post-id').value = idx;
      document.getElementById('edit-post-section').style.display = '';
      window.scrollTo(0, document.getElementById('edit-post-section').offsetTop - 60);
    }
    
    document.getElementById('edit-post-form').onsubmit = async function(e) {
      e.preventDefault();
      const idx = Number(document.getElementById('edit-post-id').value);
      const postId = postsCache[idx].id;
      
      // Process new images
      const imageInput = document.getElementById('edit-post-images');
      const newImages = await processImages(imageInput);
      
      // Combine existing images with new ones
      const existingImages = postsCache[idx].images || [];
      const allImages = [...existingImages, ...newImages];
      
      await updatePostOnServer(postId, {
        title: document.getElementById('edit-post-title').value,
        content: document.getElementById('edit-post-content').value,
        format: document.querySelector('input[name="edit-post-format"]:checked').value,
        images: allImages
      });
      postsCache = await fetchPosts();
      renderPosts();
      document.getElementById('edit-post-section').style.display = 'none';
      currentEditIndex = null;
      
      // Add enhancements after rendering
      setTimeout(() => {
        initializeEnhancements();
      }, 100);
    };
    
    document.getElementById('cancel-edit').onclick = function() {
      document.getElementById('edit-post-section').style.display = 'none';
    };
    
    async function deletePost(idx) {
      if (confirm('Delete this post?')) {
        const id = postsCache[idx].id;
        await deletePostOnServer(id);
        postsCache = await fetchPosts();
        renderPosts();
      }
    }
    
    // Initial load
    (async function() {
      postsCache = await fetchPosts();
      renderPosts();
    })();
    
    // Initialize enhancements after initial render
    setTimeout(() => {
      initializeEnhancements();
    }, 200);
  </script>

  <!-- Vendor JS Files -->
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor/aos/aos.js"></script>
  
  <!-- Template Main JS File -->
  <script src="js/main.js"></script>

  <!-- Close menu when clicking outside -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const header = document.querySelector('#header');
      const headerToggleBtn = document.querySelector('.header-toggle');
      
      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        // Check if menu is currently open
        if (header.classList.contains('header-show')) {
          // Check if click was outside the header and not on the toggle button
          if (!header.contains(event.target) && !headerToggleBtn.contains(event.target)) {
            // Close the menu
            header.classList.remove('header-show');
            headerToggleBtn.classList.remove('bi-x');
            headerToggleBtn.classList.add('bi-list');
          }
        }
      });

      // Close menu when pressing Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && header.classList.contains('header-show')) {
          header.classList.remove('header-show');
          headerToggleBtn.classList.remove('bi-x');
          headerToggleBtn.classList.add('bi-list');
        }
      });
    });
  </script>

</body>
</html> 